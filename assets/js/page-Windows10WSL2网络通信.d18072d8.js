(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{797:function(s,n,a){"use strict";a.r(n);var t=a(1),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"windows10-wsl2网络通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows10-wsl2网络通信"}},[s._v("#")]),s._v(" Windows10 WSL2网络通信")]),s._v(" "),a("h2",{attrs:{id:"wsl-命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wsl-命令"}},[s._v("#")]),s._v(" WSL 命令")]),s._v(" "),a("p",[s._v("先了解下WSL的指令都有哪些，打开Windows10系统的"),a("code",[s._v("CMD")]),s._v("窗口，或者自行下载"),a("code",[s._v("Windows Terminal")]),s._v(", 或者其他命令行工具，输入："),a("code",[s._v("wsl -h")]),s._v("即可查询，常用命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询当前系统下WSL安装的子系统版本有哪些")]),s._v("\nwsl -l\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定WSL默认使用的子系统")]),s._v("\nwsl -s "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'子系统版本'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载WSL指定的子系统")]),s._v("\nwsl -u "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'子系统版本'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"wsl下ubuntu子系统使用windows-ssh访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wsl下ubuntu子系统使用windows-ssh访问"}},[s._v("#")]),s._v(" WSL下Ubuntu子系统使用Windows ssh访问")]),s._v(" "),a("p",[s._v("这里默认使用版本："),a("code",[s._v("Ubuntu-20.04")]),s._v("，作为实现系统:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" wsl -l\n适用于 Linux 的 Windows 子系统分发版:\nUbuntu-20.04 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("默认"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"ubuntu系统安装openssh工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu系统安装openssh工具"}},[s._v("#")]),s._v(" Ubuntu系统安装openssh工具")]),s._v(" "),a("p",[s._v("wsl中默认预装了ssh工具，但是它是不能正常使用的版本，所以需要先把wsl中的ssh工具卸载，然后重装\n")]),a("p",[a("i",{staticStyle:{color:"red"}},[s._v("这里所有操作都在用户：root 下使用")])]),a("p"),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载预装的openssh工具")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" purge openssh-server\nReading package lists"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". Done\nBuilding dependency tree\nReading state information"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". Done\nPackage "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'openssh-server'")]),s._v(" is not installed, so not removed\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" upgraded, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" newly installed, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" to remove and "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" not upgraded.\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装openssh工具")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssh-server\nReading package lists"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". Done\nBuilding dependency tree\nReading state information"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". Done\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("找到sshd_conf文件，它在："),a("code",[s._v("/etc/ssh")]),s._v("目录下，然后修改它；修改内容为：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 将端口号更改下，避免22端口冲突，这里更改为8022\nPort 8022\n\n# 更改密码认证方式\nPasswordAuthentication yes\n\n# 新增配置\nPermitRootLogin yes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("重启ssh工具")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" restart\n* Restarting OpenBSD Secure Shell server sshd                                                                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" OK "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"尝试使用windows命令行工具访问wsl子系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#尝试使用windows命令行工具访问wsl子系统"}},[s._v("#")]),s._v(" 尝试使用Windows命令行工具访问wsl子系统")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8022")]),s._v(" root@localhost\nThe authenticity of "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[localhost]:8022 ([::1]:8022)'")]),s._v(" can"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t be established.\nECDSA key fingerprint is SHA256:qAX0MUfOCD5/IKmCjxFzfRUCnVtJjbPyA9NfTytBYOM.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":8022"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' (ECDSA) to the list of known hosts.\nroot@localhost'")]),s._v("s password:\nWelcome to Ubuntu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.04")]),s._v(".3 LTS "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GNU/Linux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.10")]),s._v(".16.3-microsoft-standard-WSL2 x86_64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Thu Dec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":40:09 CST "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n\n  System load:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("                Processes:             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n  Usage of /:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("% of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(".98GB   Users logged in:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Memory usage: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%                 IPv4 address "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" eth0: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.30")]),s._v(".80.97\n  Swap usage:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" updates can be applied immediately.\n\n\n\nThe programs included with the Ubuntu system are "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" software"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nthe exact distribution terms "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" each program are described "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the\nindividual files "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /usr/share/doc/*/copyright.\n\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\n\nroot@D5JYGQ2:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("在尝试登录的过程中，有个别系统可能会出现配置好之后无法访问的情况，如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8022")]),s._v(" root@localhost\nssh_exchange_identification: read: Connection reset by peer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("解决方案：在文件中新增配置："),a("code",[s._v("/etc/hosts.allow")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/hosts.allow: list of hosts that are allowed to access the system.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                   See the manual pages hosts_access(5) and hosts_options(5).")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Example:    ALL: LOCAL @some_netgroup")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#             ALL: .foobar.edu EXCEPT terminalserver.foobar.edu")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# If you\'re going to protect the portmapper use the name "rpcbind" for the')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# daemon name. See rpcbind(8) and rpc.mountd(8) for further information.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nsshd: ALL\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("配置之后再尝试就可以正常使用了")]),s._v(" "),a("h2",{attrs:{id:"在互联网中访问wsl子系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在互联网中访问wsl子系统"}},[s._v("#")]),s._v(" 在互联网中访问WSL子系统")]),s._v(" "),a("h3",{attrs:{id:"针对于虚拟网络适配器配置防火墙规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#针对于虚拟网络适配器配置防火墙规则"}},[s._v("#")]),s._v(" 针对于虚拟网络适配器配置防火墙规则")]),s._v(" "),a("p",[s._v("Windows终端CMD指令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("New-NetFirewallRule -DisplayName "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WSL"')]),s._v(" -Direction Inbound  -InterfaceAlias "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vEthernet (WSL)"')]),s._v("  -Action Allow\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"windows端口转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows端口转发"}},[s._v("#")]),s._v(" Windows端口转发")]),s._v(" "),a("p",[s._v("处理这一步很简单，只需要配置一下Windows的端口转发即可，需要用到的CMD命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" interface portproxy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" v4tov4 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机windows平台监听端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenaddress")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("wsl2平台监听端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectaddress")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("wsl2平台ip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",[a("li",[s._v("配置端口，将Windows端口2222转发到wsl子系统中的8022端口")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" netsh interface portproxy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" v4tov4 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2222")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenaddress")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8022")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectaddress")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.20")]),s._v(".224.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("配置好之后，查询下Windows配置的端口转发列表，看是否存在：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" netsh interface portproxy show all\n侦听 ipv4:                 连接到 ipv4:\n\n地址            端口        地址            端口\n--------------- ----------  --------------- ----------\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.20")]),s._v(".224.1    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2222")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.20")]),s._v(".224.1    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8022")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("有个多余的端口，如果需要删除")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" netsh interface portproxy delete v4tov4 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenaddress")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("现在，应该可以通过外网访问这个端口了，也就是可以直接访问wsl子系统了。")]),s._v(" "),a("p",{staticStyle:{color:"red"}},[s._v("值得注意的是，这个指令需要使用管理员才能执行。")]),s._v(" "),a("h2",{attrs:{id:"windows重启后自启动openssh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows重启后自启动openssh"}},[s._v("#")]),s._v(" Windows重启后自启动openssh")]),s._v(" "),a("ol",[a("li",[s._v("在wsl平台新建sh脚本，用于启动相应的服务，如openssh服务\n新建脚本：/etc/init_service.sh\n编辑脚本：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动openssh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" restart\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" docker start "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" docker-compose -f /docker/compose/docker-compose.yml up -d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("需要在Windows平台"),a("code",[s._v("win + R")]),s._v(" 输入："),a("code",[s._v("shell:startup")]),s._v("，打开自启动目录，在目录中新建vbs文件，编辑文件")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('Set ws = WScript.CreateObject("WScript.Shell")\nws.run "wsl -d Ubuntu-20.04 -u root /etc/init_service.sh",0\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后重启之后就可以通过windows访问了。")]),s._v(" "),a("h2",{attrs:{id:"答疑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#答疑"}},[s._v("#")]),s._v(" 答疑")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("wsl2平台IP地址如何获取\n通过命令"),a("code",[s._v("ip addr")]),s._v("查看eth网卡的IP地址，即为wsl平台系统的地址")])]),s._v(" "),a("li",[a("p",[s._v("Windows系统重启之后无法通过互联网访问wsl平台\nWSL平台在每次重启之后都会在系统中生成一个虚拟IP地址，类似docker。所以每次重启系统之后，之前配置的端口转发就会失效，\n也就是说，每次重启系统，需要重新配置一下端口转发的地址，这不就有问题了？所以可以修改下自启动脚本：")])])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('Set ws = WScript.CreateObject("WScript.Shell")\n\' 启动wsl平台需要开机自启的服务\nws.run "wsl -d Ubuntu-20.04 -u root /etc/init_service.sh",0\n\' 执行指令获取wsl平台ip地址，有个局限，那就是如果设置了多个ip地址，则这里将会出现多个ip地址，会出问题，如有能力，可以自行更改\ncommandLine = "wsl -d Ubuntu-20.04 -u root /opt/wsl_ip/wsl_ip.sh"\n\' 执行后获取结果，了解更多可以关注对应的函数\nSet result = ws.Exec(commandLine)\nipaddr = result.StdOut.ReadAll()\nipLength = Len(ipaddr)\n\' 截取ip地址\nip = Left(ipaddr, ipLength - 1)\n\' 设置端口转发\nrun_cmd_wsl ="netsh interface portproxy add v4tov4 listenport=2222 listenaddress=0.0.0.0 connectport=8022 connectaddress="&amp;ip\nws.run run_cmd_wsl,0\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("你以为这个配置到这里就成功了？错，重启之后还是不能通过互联网访问wsl平台，原因是因为端口转发指令需要用到管理员权限，所以还需要修改一下vbs文件：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\' 获取管理员权限\nSet WshShell = WScript.CreateObject("WScript.Shell")\nIf WScript.Arguments.Length = 0 Then\n  Set ObjShell = CreateObject("Shell.Application")\n  ObjShell.ShellExecute "wscript.exe" _\n    , """" &amp; WScript.ScriptFullName &amp; """ RunAsAdministrator", , "runas", 1\n  WScript.Quit\nEnd if\n\nSet ws = WScript.CreateObject("WScript.Shell")\n\' 启动wsl平台需要开机自启的服务\nws.run "wsl -d Ubuntu-20.04 -u root /etc/init_service.sh",0\n\' 执行指令获取wsl平台ip地址，有个局限，那就是如果设置了多个ip地址，则这里将会出现多个ip地址，会出问题，如有能力，可以自行更改\ncommandLine = "wsl -d Ubuntu-20.04 -u root /opt/wsl_ip/wsl_ip.sh"\n\' 执行后获取结果，了解更多可以关注对应的函数\nSet result = ws.Exec(commandLine)\nipaddr = result.StdOut.ReadAll()\nipLength = Len(ipaddr)\n\' 截取ip地址\nip = Left(ipaddr, ipLength - 1)\n\' 设置端口转发\nrun_cmd_wsl ="netsh interface portproxy add v4tov4 listenport=2222 listenaddress=0.0.0.0 connectport=8022 connectaddress="&amp;ip\nws.run run_cmd_wsl,0\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("至此，配置完成了，重启后可以访问了。")]),s._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("p",[s._v("- [1] "),a("a",{attrs:{href:"https://www.cnblogs.com/kuangdaoyizhimei/p/14175143.html#_caption2",target:"_blank",rel:"noopener noreferrer"}},[s._v("win10新版wsl2使用指南"),a("OutboundLink")],1)]),a("p"),s._v("\n- [2] "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/365058237",target:"_blank",rel:"noopener noreferrer"}},[s._v("WSL2 连接 Windows 防火墙问题解决方案"),a("OutboundLink")],1),a("p"),s._v("\n- [3] "),a("a",{attrs:{href:"https://blog.csdn.net/lilygg/article/details/86187028",target:"_blank",rel:"noopener noreferrer"}},[s._v("解决 ssh_exchange_identification: read: Connection reset by peer问题"),a("OutboundLink")],1),a("p"),a("p")])}),[],!1,null,null,null);n.default=e.exports}}]);